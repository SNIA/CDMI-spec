.. _clause_cdmi_metadata:

Metadata
========

Support for User Metadata
*************************

All CDMI objects that support metadata shall permit the inclusion of arbitrary user-defined metadata items, with the restriction that the name of a user-defined metadata item shall not start with the prefix "cdmi\_".


* The maximum number of user-defined metadata items is specified by the capability cdmi_metadata_maxitems.
* The maximum size of each user-defined metadata item is specified by the capability cdmi_metadata_maxsize.
* The maximum total size of user-defined metadata items for an object is specified by the capability cdmi_metadata_maxtotalsize.



.. _ref_support_for_storage_system_metadata:

Support for Storage System Metadata
***********************************

After an object has been created, the storage system metadata, as described in :numref:`storage_system_metadata`  shall be generated by the cloud storage system and shall immediately be made available to a CDMI client in the metadata that is returned as a result of the create operation and any subsequent retrievals.


.. _tbl_storage_system_metadata:

.. list-table:: .*
    :header-rows: 1
    :widths: auto
    :align: center 


    * - Metadata Name
      - Type
      - Description
      - Requirement
    * - cdmi_size
      - JSON String
      - The number of bytes consumed by the object. This storage system metadata item is computed by the storage system, and any attempts to set or modify it will be ignored.
      - Optional
    * - cdmi_ctime
      - JSON String
      - The time when the object was created, in  ISO-8601 point-in-time format, as described in :numref:`ref_time_representations`.
        
        
        This metadata value can only be updated by a client if it has the "backup_operator" privilege. If a client does not have the "backup operator privilege, updates of this metadata item shall be ignored.
      - Optional
    * - cdmi_atime
      - JSON String
      - The time when the object was last accessed in ISO-8601 point-in-time format, as described in :numref:`ref_time_representations`. The access or modification of a child is not considered an access of a parent container (access/modify times do not propagate up the tree). For a newly created object, this value shall be set to the creation time.

        This metadata value can only be updated by a client if it has the "backup_operator" privilege. If a client does not have the "backup operator privilege, updates of this metadata item shall be ignored.
      - Optional
    * - cdmi_mtime
      - JSON String
      - The time when the object was last modified, in ISO-8601 point-in-time format, as described in :numref:`ref_time_representations`. The modification of a child is not considered a modification of a container object (modification times do not propagate up the tree). For a newly created object, this value shall be set to the creation time.
    
        This metadata value can only be updated by a client if it has the "backup_operator" privilege. If a client does not have the "backup operator privilege, updates of this metadata item shall be ignored.
      - Optional
    * - cdmi_acount
      - JSON String
      - The number of times that the object has been accessed since it was originally created. Accesses include all reads, writes, and lists. For a newly created object, this value shall be set to the value "0".

        This metadata value can only be updated by a client if it has the "backup_operator" privilege. If a client does not have the "backup operator privilege, updates of this metadata item shall be ignored.
      - Optional
    * - cdmi_mcount
      - JSON String
      - The number of times that the object has been modified since it was originally created. Modifications include all value and metadata changes. Modifications to metadata resulting from reads (such as updates to atime) do not count as a modification. For a newly created object, this value shall be set to the value "0".

        This metadata value can only be updated by a client if it has the "backup_operator" privilege. If a client does not have the "backup operator privilege, updates of this metadata item shall be ignored.
      - Optional
    * - cdmi_hash
      - JSON String
      - The hash of the value of the object, encoded using Base16 encoding rules described in :rfc:`4648`. This metadata field shall be present when the cdmi_value_hash data system metadata for the object or a parent object indicates that the value of the object should be hashed.
      - Optional
    * - cdmi_owner
      - JSON String
      - The name of the principal that has owner privileges for the object.
      - Mandatory
    * - cdmi_acl
      - JSON Array of JSON Objects
      - Standard ACL metadata. If not specified when the object is created, this metadata shall be filled in by the system.
      - Optional


.. _ref_support_for_data_system_metadata:

Support for Data System Metadata
********************************

When specified, data system metadata provides guidelines to the cloud storage system on how to provide storage data services for data managed through the CDMI interface.

Data system metadata (see :numref:`tbl_data_system_metadata`  is inherited from parent objects to any children. If a child explicitly contains data system metadata, the metadata value of the child data system metadata shall override the metadata value of the parent data system metadata. 

.. tabularcolumns:: |>{\raggedright\arraybackslash}\Y{0.29}
                    |>{\raggedright\arraybackslash}\Y{0.09}
                    |>{\raggedright\arraybackslash}\Y{0.48}
                    |>{\raggedright\arraybackslash}\Y{0.14}|

.. _tbl_data_system_metadata:

.. list-table:: Data System Metadata
    :class: longtable
    :header-rows: 1
    :align: center 

    * - Metadata Name
      - Type
      - Description
      - Requirement
    * - cdmi_data_redundancy
      - JSON String
      - If this data system metadata item is present and set to a positive numeric string, it indicates that the client is requesting a desired number of complete copies. Additional copies may be made to satisfy demand for the value. When this data system metadata item is absent, or is present and is not set to a positive numeric string, this data system metadata item shall not be used.
      - Optional
    * - cdmi_immediate_redundancy
      - JSON String
      - If this data system metadata item is present and set to "true", it indicates that the client is requesting that at least the number of copies indicated in cdmi_data_redundancy  contain the newly written value before the operation completes. This metadata is used to make sure that multiple copies of the data are written to permanent storage to prevent possible data loss. When this data system metadata item is absent, or is present and is not set to "true", this data system metadata item shall not be used. 

        If the requested number of copies cannot be created within the HTTP timeout period, the transaction shall complete, but the cdmi_immediate_redundancy_provided data system metadata shall be set to "false".  
      - Optional
    * - cdmi_assignedsize
      - JSON String
      - If this data system metadata item is present and set to a positive numeric string, it indicates that the client is specifying the size in bytes that is desired to be reported for a container object exported via other protocols (see :numref:`ref_container_metadata`). The system is not required to reserve this space and may thin-provision the requested space. Thus, the requested value may be greater than the actual storage space consumed. When this data system metadata item is absent, or is present and is not set to a positive numeric string, this data system metadata item shall not be used. 

        This data system metadata item is only applied against container objects and is not inherited by child objects.
      - Optional
    * - cdmi_infrastructure_redundancy
      - JSON String
      - If this data system metadata item is present and set to a positive numeric string, it indicates that the client is requesting a desired number of independent storage infrastructures supporting the multiple copies of data. This metadata is used to convey that, of the copies specified in cdmi_data_redundancy, these copies shall be stored on this many separate infrastructures. When this data system metadata item is absent, or is present and is not set to a positive numeric string, this data system metadata item shall not be used. 
      - Optional
    * - cdmi_data_dispersion
      - JSON String
      - If this data system metadata item is present and set to a positive numeric string, it indicates that the client is requesting a minimum desired distance (in km) between the infrastructures supporting the multiple copies of data. This metadata is used to separate the (cdmi_infrastructure_redundancy number of) infrastructures by a minimum geographic distance to prevent data loss due to site disasters. When this data system metadata item is absent, or is present and is not set to a positive numeric string, this data system metadata item shall not be used.
      - Optional
    * - cdmi_geographic_placement
      - JSON Array of JSON Strings
      - If this data system metadata item is present and set to zero or more geopolitical identifiers, it indicates that the client is requesting restrictions on the geographic regions where the object is permitted to be stored. Each geopolitical identifier shall be in the form of either a string containing a valid ISO 3166 country/country-subdivision code, which indicates that storage is permitted within that geopolitical region, or in the form of a string starting with the "!" character in front of a valid ISO 3166 country/country-subdivision code, which excludes that country/country-subdivision from the previous list of geopolitical regions. 

        The list is evaluated, in order, from left to right, with evaluation of each candidate storage location stopping when the candidate location is a permitted or prohibited region or is contained within a permitted or prohibited region. In addition to the ISO 3166 codes, "*" shall indicate all regions. If a candidate location does not match any of the entries in the list, the candidate location shall be considered to be prohibited. 
      
        * When this data system metadata item is absent, this data system metadata item shall not be used. 
        * When this data system metadata item is present and does not contain valid geopolitical identifiers, the create, update, or deserialize operation shall fail with an HTTP status code of ``400 Bad Request.``
        * When this data system metadata item is present and valid, but no available storage locations are permitted, the create, update, or deserialize operation shall fail with an HTTP status code of ``403 Forbidden.``
      - Optional
    * - cdmi_retention_id
      - JSON String
      - If this data system metadata item is present and not an empty string, it indicates that the client is requesting that the string be used to tag a given object as being managed by a specific retention policy. This data system metadata item is not required to place an object under retention, but is useful when needing to be able to perform a query to find all objects under a specific retention policy. When this data system metadata item is absent, or is present and an empty string, this data system metadata item shall not be used.
      - Optional
    * - cdmi_retention_period
      - JSON String
      - If this data system metadata item is present and contains a valid ISO 8601:2004 time interval (as described in ), it indicates that the client is requesting that an object be placed under retention (see :numref:`cdmi_retention`). When this data system metadata item is absent, this data system metadata item shall not be used. When this data system metadata item is present but does not contain a valid ISO 8601:2004 time interval, the create, update, or deserialize operation shall fail with an HTTP status code of ``400 Bad Request``.
      
        If this data system metadata item is updated and the new end date is before the current end date, the update operation shall fail with an HTTP status code of ``403 Forbidden``. 
      - Optional
    * - cdmi_retention_autodelete
      - JSON String
      - If this data system metadata item is present and set to "true", it indicates that the client is requesting that an object under retention be automatically deleted when retention expires. When this data system metadata item is absent, or is present and is not set to "true", this data system metadata item shall not be used.
      - Optional
    * - cdmi_hold_id
      - JSON Array of JSON Strings
      - If this data system metadata item is present and not an empty array, it indicates that the client is requesting that an object be placed under hold (see :numref:`cdmi_hold`). Each string in the array shall contain a unique user-specified hold identifier. 
      
        When this data system metadata item is absent, or is present and is an empty JSON array, this data system metadata item shall not be used. 
        
        If this data system metadata item is updated, and a previously existing hold string has been removed or changed in the update, the update operation shall fail with an HTTP status code of ``403 Forbidden``. (See :numref:`cdmi_hold` concerning releasing holds.)
      - Optional
    * - cdmi_encryption
      - JSON String
      - If this data system metadata item is present and not an empty string, it indicates that the client is requesting that the object be encrypted while at rest. If encrypted, all data and metadata related to the object shall be encrypted. Supported algorithm/mode/length values are provided by the cdmi_encryption capability. 

        When this data system metadata item is absent, this data system metadata item shall not be used. 
        
        If this data system metadata item is present but does not contain a valid encryption algorithm/mode/length string, the system is free to choose to ignore the data system metadata, to fail with an HTTP status code of ``400 Bad Request``, or to select an encryption algorithm/mode/length of the system's choice. 

        Supported encryption algorithms are expressed as a string in the form of ALGORITHM_MODE_KEYLENGTH, where: 
        
        * "ALGORITHM" is the encryption algorithm (e.g., "AES" or "3DES"). 
        * "MODE" is the mode of operation (e.g., "XTS", "CBC", or "CTR"). 
        * "KEYLENGTH" is the key size in bytes (e.g., "128", "192", "256"). 

        To improve interoperability between CDMI implementations, the following designators should be used for the more common encryption combinations: 
        
        * "3DES_ECB_168" for the three-key TripleDES algorithm, the Electronic Code Book (ECB) mode of operation, and a key size of 168 bits; 
        * "3DES_CBC_168" for the three-key TripleDES algorithm, the Cipher Block Chaining (CBC) mode of operation, and a key size of 168 bits; 
        * "AES_CBC_128" for the AES algorithm, the CBC mode of operation, and a key size of 128 bits; 
        * "AES_CBC_256" for the AES algorithm, the CBC mode of operation, and a key size of 256 bits; 
        * "AES_XTS_128" for the AES algorithm, the XTS mode of operation, and a key size of 128 bits; and 
        * "AES_XTS_256" for the AES algorithm, the XTS mode of operation, and a key size of 256 bits.

      - Optional
    * - cdmi_value_hash 
      - JSON String
      - If this data system metadata item is present and not an empty string, it indicates that the client is requesting that the system hash the object value using the hashing algorithm and length requested. The result of the hash shall be provided in the cdmi_hash storage system metadata item. Supported algorithm/length values are provided by the cdmi_value_hash capability. 

        When this data system metadata item is absent, this data system metadata item shall not be used. 

        If this data system metadata item is present but does not contain a valid hash algorithm/length string, the system is free to choose to ignore the data system metadata, to fail with an HTTP status code of ``400 Bad Request``, or to select a hash algorithm/length of the system's choice. 

        Supported hash algorithms are expressed as a string in the form of ALGORITHM LENGTH, where: 
        
        * "ALGORITHM" is the hash algorithm (e.g., "SHA"). 
        * "LENGTH" is the hash size in bytes (e.g., "160", "256"). 


        To improve interoperability between CDMI implementations, the following designators should be used for the more common encryption combinations: 
        
        * "SHA160" for SHA-1, and 
        * "SHA256" for SHA-2.
      - Optional
    * - cdmi_latency
      - JSON String
      - If this data system metadata item is present and set to a positive numeric string, it indicates that the client is requesting a desired maximum time to first byte, in milliseconds. This metadata is the desired latency (in milliseconds) to the first byte of data, as measured from the edge of the cloud and factoring out any propagation latency between the client and the cloud. For example, this metadata may be used to determine, in an interoperable way, from what type of storage medium the data may be served. When this data system metadata item is absent, or is present and is not set to a positive numeric string, this data system metadata item shall not be used.
      - Optional
    * - cdmi_throughput
      - JSON String
      - If this data system metadata item is present and set to a positive numeric string, it indicates that the client is requesting a desired maximum data rate on retrieve, in bytes per second. This metadata is the desired bandwidth to the data, as measured from the edge of the cloud and factoring out any bandwidth capability between the client and the cloud. This metadata is used to stage the data in locations where there is sufficient bandwidth to accommodate a maximum usage. When this data system metadata item is absent, or is present and is not set to a positive numeric string, this data system metadata item shall not be used. 
      - Optional
    * - cdmi_sanitization_method
      - JSON String
      - If this data system metadata item is present and not an empty string, it indicates that the client is requesting that the system use a specific sanitization method to delete data such that the data is unrecoverable after an update or delete operation. Supported sanitization method values are provided by the cdmi_sanitization_method capability. 

        When this data system metadata item is absent, this data system metadata item shall not be used. 

        If this data system metadata item is present but does not contain a valid sanitization method string, the system is free to choose to ignore the data system metadata, to fail with an HTTP status code of ``400 Bad Request``, or to select a sanitization method of the system's choice.

        Supported sanitization methods are defined as system-specific strings.
      - Optional
    * - cdmi_RPO
      - JSON String
      - If this data system metadata item is present and set to a positive numeric string, it indicates that the client is requesting a largest acceptable duration in time between an update or create and when the object may be recovered, specified in seconds. This metadata is used to indicate the desired backup frequency from the primary copy or copies of the data to the secondary copy or copies. It is the maximum acceptable time period before a failure or disaster during which changes to data may be lost as a consequence of recovery. When this data system metadata item is absent, or is present and is not set to a positive numeric string, this data system metadata item shall not be used. 
      - Optional
    * - cdmi_RTO
      - JSON String
      - If this data system metadata item is present and set to a positive numeric string, it indicates that the client is requesting the largest acceptable duration in time to restore data, specified in seconds. This metadata is used to indicate the desired maximum acceptable duration to restore the primary copy or copies of the data from a secondary backup copy or copies. When this data system metadata item is absent, or is present and is not set to a positive numeric string, this data system metadata item shall not be used.
      - Optional
    * - cdmi_authentication_methods
      - JSON Array of JSON Strings
      - The client shall set this metadata to a list of authentication methods requested to be enabled for the domain.

        Supported authentication method values are indicated by the cdmi_authentication_methods capability.
      - 


.. _ref_support_for_provided_data_system_metadata:

Support for Provided Data System Metadata
*****************************************

For each metadata item in a data system, there is an actual value that the cloud service is able to achieve at this time, as shown in :numref:`tbl_provided_values_of_data_systems_metadata_items`  Data system-provided metadata items are read only. Updates of these metadata items shall be ignored.


.. _tbl_provided_values_of_data_systems_metadata_items:

.. list-table:: .*
    :header-rows: 1
    :widths: auto
    :align: center 


    * - Metadata Name
      - Type
      - Description
      - Requirement
    * - cdmi_data_redundancy_provided
      - JSON String
      - Contains the current number of complete copies of the data object at this time
      - Optional
    * - cdmi_immediate_redundancy_provided
      - JSON String
      - If present and set to "true", indicates if immediate redundancy is provided for the object
      - Optional
    * - cdmi_infrastructure_redundancy_provided
      - JSON String
      - Contains the current number of independent storage infrastructures supporting the data currently operating
      - Optional
    * - cdmi_data_dispersion_provided
      - JSON String
      - Contains the current lowest distance (km) between any two infrastructures hosting the data
      - Optional
    * - cdmi_geographic_placement_provided
      - JSON Array of JSON Strings
      - Contains an ISO-3166 identifier that corresponds to a geopolitical region where the object is stored
      - Optional
    * - cdmi_retention_period_provided
      - JSON String
      - Contains an :numref:`ref_iso_8601:2004` time interval (as described in :numref:`ref_time_representations`) specifying the period the object is protected by retention
      - Optional
    * - cdmi_retention_autodelete_provided
      - JSON String
      - Contains "true" if the object will automatically be deleted when retention expires
      - Optional
    * - cdmi_hold_id_provided
      - JSON Array of JSON Strings
      - Contains the user-specified hold identifiers for active holds
      - Optional
    * - cdmi_encryption_provided
      - JSON String
      - Contains the algorithm used for encryption, the mode of operation, and the key size. (See :numref:`ref_cdmi_encryption` in :numref:`ref_data_system_metadata` for the format.)
      - Optional
    * - cdmi_value_hash_provided
      - JSON String
      - Contains the algorithm and length being used to hash the object value. (See :numref:`ref_cdmi_value_hash` in :numref:`ref_data_system_metadata` for the format.)
      - Optional
    * - cdmi_latency_provided
      - JSON String
      - Contains the provided maximum time to first byte
      - Optional
    * - cdmi_throughput_provided 
      - JSON String
      - Contains the provided maximum data rate on retrieve
      - Optional
    * - cdmi_sanitization_method_provided
      - JSON String
      - Contains the sanitization method used. (See :numref:`ref_cdmi_sanitization_method` in :numref:`ref_data_system_metadata` for the format.)
      - Optional
    * - cdmi_RPO_provided
      - JSON String
      - Contains the provided duration, in seconds, between an update and when the update may be recovered
      - Optional
    * - cdmi_RTO_provided
      - JSON String
      - Contains the provided duration, in seconds, to restore data
      - Optional
    * - cdmi_authentication_methods_provided
      - JSON Array of JSON Strings
      - Contains a list of authentication methods enabled for the domain. (See :numref:`ref_cdmi_authentication_methods` in :numref:`ref_data_system_metadata` for the format.)
      - Optional




Metadata Update Operations
**************************

CDMI permits a client to replace all metadata items or to perform operations against one or more individual metadata items. 

Replacing all metadata items is accomplished by including the metadata field in the update request body JSON and not specifying specific metadata items in the update URI. 

Adding, updating, and removing specific metadata items is accomplished by specifying the specific metadata item names in the update URI: 


* To add a new metadata item to an existing object, the metadata item name shall be included in the update request URI, and the metadata item shall be included in the metadata field in the update request body JSON. 
* To update the value of an existing metadata item, the metadata item name shall be included in the update request URI, and the metadata item shall be included in the metadata field in the update request body JSON. 
* To remove an existing metadata item, the metadata item name shall be included in the update request URI, and the metadata item shall not be included in the metadata field in the update request body JSON. 


When individual metadata items are specified in the update URI, metadata items included in the metadata field in the request body JSON that are not referred to in the update URI shall be ignored.
