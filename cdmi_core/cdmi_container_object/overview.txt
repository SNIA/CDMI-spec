.. _ref_cdmi_container_object_overview:

Overview
********

Container objects are the fundamental grouping of stored data within CDMIâ„¢ and are analogous to directories within a file system. Each container object has a set of well-defined fields that include:

* zero or more child objects,
* mandatory fields generated by the cloud storage system,
* mandatory metadata items generated by the cloud storage system,
* optional metadata generated by the cloud storage system; and
* optional metadata specified by the cloud user.

All cloud storage systems shall support containers, but the ability to create a containers is determiend by the presence or absence of the ``cdmi_create_container`` capability in the parent container.

Each CDMI container object is represented as a JSON object, containing one or more "fields". For example, the "``metadata``" field contains metadata items.

EXAMPLE 1: CDMI Container Object

  .. code-block:: none

    {
        "objectType" : "application/cdmi-container",
        "objectID" : "00007ED900104E1D14771DC67C27BF8B",
        "objectName" : "MyContainer/",
        "parentURI" : "/",
        "parentID" : "00007E7F0010128E42D87EE34F5A6560",
        "domainURI" : "/cdmi_domains/MyDomain/",
        "capabilitiesURI" : "/cdmi_capabilities/container/",
        "completionStatus" : "Complete",
        "metadata" : {
            "cdmi_ctime" : "2018-05-16T08:01:02.353Z"
        },
        "childrenrange" : "0-4",
        "children" : [
            "red",
            "green",
            "yellow",
            "orange/",
            "purple/"
        ]
    }

The meaning, use, and permitted values of each field is described in each operation that creates, modifies or retreives CDMI container objects.

Container object details
************************

Container object addressing
---------------------------

Container objects are addressed in CDMI in two ways:

* by name (e.g. ``https://cloud.example.com/container/``); and
* by ID (e.g. ``https://cloud.example.com/cdmi_objectid/00007ED900104E1D14771DC67C27BF8B/``).

Every container object has a single, globally-unique object ID that remains constant for the life of the object. Each container object may also have one or more URI addresses that allow the container object to be accessed.

When a container object is addressed via more than one unique URIs, all operations may be performed through any of these URIs. For example, a container object may be accessible via multiple virtual hosting paths, where ``https://cloud.example.com/users/snia/cdmi/`` is also accessible through ``https://snia.example.com/cdmi/``. Conflicting writes via different paths shall be managed the same way that conflicting writes via one path are managed, via the principle of eventual consistency (see :numref:`%s <ref_cdmi_container_object_create>`).

Following the URI conventions for hierarchical paths, container URIs shall consist of one or more container names that are separated by forward slashes ("``/``") and that end with a forward slash ("``/``").

If a request is performed against an existing container resource and the trailing slash at the end of the URI is omitted, the server shall respond with an HTTP status code of ``301 Moved Permanently``. In addition, a Location header containing the URI with the trailing slash added shall be returned.

If a CDMI request is performed to create a new container resource and the trailing slash at the end of the URI is omitted, the server shall respond with an HTTP status code of ``400 Bad Request``.

Non-CDMI requests to create a container resource shall include the trailing slash at the end of the URI; otherwise, the request shall be considered a request to create a data object.

Containers may also be nested.

    EXAMPLE 2: The following URI represents a nested container:

        ``https://cloud.example.com/container/subcontainer/``

A nested container has a parent container object, shall be included in the children field of the parent container object, and shall inherit data system metadata and ACLs from its parent container.

This model allows direct mapping between CDMI-managed cloud storage and file systems (e.g., NFSv4 or WebDAV). If a CDMI container object is exported as a file system, then the file system may make the CDMI metadata accessible via file system-specific mechanisms. As files and directories are created by the file system, they become visible through the CDMI interface acting as a data path. The mapping between file system constructs and CDMI data objects, container objects, and metadata is outside the scope of this International Standard.

Container object fields
-----------------------

Individual fields within a container object may be accessed by specifying the field name after a question mark "``?``" appended to the end of the container object URI.

    EXAMPLE 3: The following URI returns just the children field in the response body:

        ``https://cloud.example.com/container/?children``

    EXAMPLE 4: By specifying a range after the children field name, specific ranges of the children field may be accessed.

        ``https://cloud.example.com/container/?children:0-2``

Children ranges are specified in a way that is similar to byte ranges as per Section 14.35.1 of RFC 2616 :cite:`rfc2616`. A client can determine the number of children present by requesting the childrenrange field without requesting a range of children.

A list of fields, separated by a semicolon ";" may be specified, allowing multiple fields to be accessed in a single request.

    EXAMPLE 5: The following URI would return the children and metadata fields in the response body:

        ``https://cloud.example.com/container/?children;metadata``

When a client provides fields that are not defined in this International Standard or deserializes an object containing fields that are not defined in this International Standard, these fields shall be persisted, but shall not be interpreted.

.. _ref_container_metadata:

Container object metadata
-------------------------

The following optional container-specific data system metadata may be provided (see :numref:`tbl_container_metadata`).

.. tabularcolumns:: |>{\raggedright\arraybackslash}\Y{0.20}
                    |>{\raggedright\arraybackslash}\Y{0.10}
                    |>{\raggedright\arraybackslash}\Y{0.55}
                    |>{\raggedright\arraybackslash}\Y{0.15}|

.. _tbl_container_metadata:

.. list-table:: Container metadata
    :class: longtable
    :header-rows: 1
    :align: center

    * - Metadata Name
      - Type
      - Description
      - Requirement
    * - cdmi_assignedsize
      - JSON string
      - The number of bytes that is reported via exported protocols (e.g., the device may be thin provisioned). This number may limit ``cdmi_size``.
      - Optional

Container metadata may also include arbitrary user-supplied metadata, storage system metadata, and data system metadata as described in :numref:`clause %s <clause_cdmi_metadata>`.

Container object access control
-------------------------------

If read access to any of the requested fields is not permitted by the object ACL, only the permitted fields shall be returned. If no requested fields are permitted to be read, an HTTP status code of ``403 Forbidden`` shall be returned to the client.

If write access to any of the requested fields is not permitted by the object ACL, no updates shall be performed, and an HTTP status code of ``403 Forbidden`` shall be returned to the client.

Reserved container object names
-------------------------------

This International Standard defines reserved container names that should not be used by clients when creating new containers. These container names are reserved for use by this International Standard, and if an attempt is made to create or delete them, an HTTP status code of ``400 Bad Request`` shall be returned to the client.

Reserved container names defined in this specification include:

* "``cdmi_objectid``"
* "``cdmi_domains``"
* "``cdmi_capabilities``"
* "``cdmi_snapshots`` "
* "``cdmi_versions``"

As additional names may be added in future versions of this International Standard, server implementations shall prevent the creation of user-defined containers if the container name starts with "``cdmi_``".

Container object representations
--------------------------------

The representations in this clause are shown using JSON notation. Both clients and servers shall support UTF-8 JSON representation. The request and response body JSON fields may be specified or returned in any order, with the exception that, if present, for container objects, the "``childrenrange``" and "``children``" fields shall appear last and in that order.
