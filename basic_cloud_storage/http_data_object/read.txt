.. _http_data_object_read:

    
Read a Data Object using HTTP
*****************************


Synopsis
--------

The following HTTP GET operations read from an existing data object at the specified URI:

* ``GET <root URI>/<ContainerName>/<DataObjectName>``
* ``GET <root URI>/cdmi_objectid/<DataObjectID>``

Where:

* ``<root URI>`` is the path to the CDMI cloud.
* ``<ContainerName>`` is zero or more intermediate containers.
* ``<DataObjectName>`` is the name of the data object to be read from.
* ``<DataObjectID>`` is the ID of the data object to be read from.


Capabilities
------------

The following capabilities describe the supported operations that may be performed when reading an existing data object:

* Support for the ability to read the value of an existing data object is indicated by the presence of the ``cdmi_read_value capability`` in the specified object. Any read from a specific byte location not previously written to by a create or update operation shall return zero for the byte value.
* Support for the ability to read the value of an existing data object in specific byte ranges is indicated by the presence of the ``cdmi_read_value_range`` capability in the specified object. Any read from a specific byte location within the value range specified not previously written to by a create or update operation shall return zero for the byte value.


Request Header
--------------

The HTTP request header for reading a CDMI data object using HTTP is shown in :numref:`tbl_http_data_object_readrequest_header`. 

.. tabularcolumns:: |>{\raggedright\arraybackslash}\Y{0.20}
                    |>{\raggedright\arraybackslash}\Y{0.10}
                    |>{\raggedright\arraybackslash}\Y{0.55}
                    |>{\raggedright\arraybackslash}\Y{0.15}|

.. _tbl_http_data_object_readrequest_header:

.. list-table:: Request Header - Read a CDMI Data Object using HTTP
    :header-rows: 1
    :widths: 20 10 55 15
    :align: center
    
    * - Header
      - Type
      - Description
      - Requirement
    * - Range
      - Header String
      - A valid ranges-specifier (see :rfc:`2616` Section 14.35.1)
      - Optional
	* - Accept
	  - Header String
	  - "\*/\*" or a value as per `clause %s <_ref_content-type_negotiation>` "Content-type negotiation".
	  
	    If the object has a mimetype of "application/cms" or "application/jose+json", and the mimetype "application/cms" or "application/jose+json" is included in the Accept mimetype, the CDMI server shall return the CMS or JOSE value in the response message body. 
	  
	    Otherwise, the decrypted plaintext shall be returned in the response message body, along with the encapsulated mimetype in the Content-Type response header. If decryption is not possible, an error result code shall be returned. (See `clause %s <clause_encrypted_object>` â€“ Encrypted Objects) 
	  
	    If the Accept mimetype list includes "\*/\*" before "application/cms" and/or "application/jose+json", the server will first try to return the decrypted plaintext, and shall return the CMS or JOSE value when decryption fails. 
	  
	    If the Accept mimetype list excludes "\*/\*", decrypted plaintext shall only be returned if the encapsulated mimetype is included in the Accept mimetype list. 
	  - Optional
		
Request Message Body
--------------------

A request body shall not be provided.


Response Headers
----------------

The HTTP response headers for reading a data object using HTTP are shown in :numref:`tbl_http_data_object_readresponse_headers`.

.. tabularcolumns:: |>{\raggedright\arraybackslash}\Y{0.20}
                    |>{\raggedright\arraybackslash}\Y{0.10}
                    |>{\raggedright\arraybackslash}\Y{0.55}
                    |>{\raggedright\arraybackslash}\Y{0.15}|

.. _tbl_http_data_object_readresponse_headers:

.. list-table:: Response Headers - Read a CDMI Data Object using HTTP
    :header-rows: 1
    :widths: 20 10 55 15
    :align: center
    
    * - Header
      - Type
      - Description
      - Requirement
    * - Content-Type
      - Header String
      - The content type returned shall be the mimetype field in the data object.
      - Mandatory
    * - Location
      - Header String
      - The server shall respond with the URI that the reference redirects to if the object is a reference.
      - Conditional


Response Message Body
---------------------

When reading a data object using HTTP, the following applies:

* The response message body shall be the contents of the data object's value field.
* When reading a value, zeros shall be returned for any gaps resulting from non-contiguous writes.


Response Status
---------------

The HTTP status codes that occur when reading a data object using HTTP are described in :numref:`tbl_http_data_object_readresponse_status`.

.. tabularcolumns:: |>{\raggedright\arraybackslash}\Y{0.30}
                    |>{\raggedright\arraybackslash}\Y{0.70}|

.. _tbl_http_data_object_readresponse_status:

.. list-table:: HTTP Status Codes - Read a CDMI Data Object using HTTP
    :header-rows: 1
    :widths: 30 70
    :align: center 

    * - HTTP Status
      - Description
    * - ``200 OK``
      - The data object content was returned in the response.
    * - ``206 Partial Content``
      - A requested range of the data object content was returned in the response.
    * - ``302 Found``
      - The resource is a reference to another resource.
    * - ``400 Bad Request``
      - The request contains invalid parameters or field names.
    * - ``401 Unauthorized``
      - The authentication credentials are missing or invalid.
    * - ``403 Forbidden``
      - The client lacks the proper authorization to perform this request.
    * - ``404 Not Found``
      - The resource was not found at the specified URI, or a requested field within the resource was not found.


Examples
--------

EXAMPLE 1: GET to the data object URI to read the value of the data object:

   .. code-block:: http

       GET /MyContainer/MyDataObject.txt HTTP/1.1
       Host: cloud.example.com 

   The following shows the response.

   .. code-block:: http
   
       HTTP/1.1 200 OK
       Content-Type: text/plain
       Content-Length: 37
       
       This is the Value of this Data Object

EXAMPLE 2: GET to the data object URI to read the first 11 bytes of the value of the data object:

   .. code-block:: http

       GET /MyContainer/MyDataObject.txt HTTP/1.1
       Host: cloud.example.com 
       Range: bytes=0-10

   The following shows the response.

   .. code-block:: http
   
       HTTP/1.1 206 Partial Content
       Content-Type: text/plain
       Content-Range: bytes 0-10/37
       Content-Length: 11
       
       This is the
	   
	   
EXAMPLE 3: GET to the data object URI to always return the ciphertext of an encrypted object:

	.. code-block:: http

		GET /MyContainer/MyEncryptedObject.txt HTTP/1.1
		Host: cloud.example.com
		Accept: application/cms, application/jose+json

	The following shows the response:

	.. code-block:: http

		HTTP/1.1 200 OK
		Content-Type: application/cms
		Content-Length: 1425

		<CMS Encrypted Object>

EXAMPLE 4: GET to the data object URI to read the plaintext of an encrypted object, if possible; otherwise, get the ciphertext:

	.. code-block:: http

		GET /MyContainer/MyEncryptedObject.txt HTTP/1.1
		Host: cloud.example.com
		Accept: */*, application/cms, application/jose+json
		<Header credentials used to authenticate and access the decryptionkey>

	The following shows the response:	  

	.. code-block:: http

		HTTP/1.1 200 OK
		Content-Type: text/plain
		Content-Length: 252

		<Decrypted contents of Encrypted Value>

EXAMPLE 5: GET to the data object URI to read the plaintext of an encrypted object:

	.. code-block:: http

		GET /MyContainer/MyEncryptedObject.txt HTTP/1.1
		Host: cloud.example.com
		<Header credentials used to authenticate and access the decryption key>

	The following shows the response:

   .. code-block:: http

		HTTP/1.1 200 OK
		Content-Type: text/plain
		Content-Length: 252

		<Decrypted contents of Encrypted Value>
